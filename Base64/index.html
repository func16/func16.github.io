<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
<title>Base64</title>
</head>

<body>
<h2>Base64</h2>
<p>转换前</p>
<input id="upfile" name="upfile" type="file" value="载入" multiple="multiple" /><br>
<textarea name="input0" rows="3" cols="3" style="overflow:none;width:360px;height:120px;"></textarea>
<br>
<input type="button" value="粘贴" onclick="document.getElementsByName('input0')[0].value=window.clipboardData.getData('text')">
<input type="button" value="复制" onclick="window.clipboardData.setData('text',document.getElementsByName('input0')[0].value);">
<input type="button" value="清空" onclick="document.getElementsByName('input0')[0].value=''">
<p>转换后</p>
<textarea name="output0" rows="3" cols="3" style="overflow:none;width:360px;height:120px;"></textarea>
<br>
<input type="button" value="粘贴" onclick="document.getElementsByName('output0')[0].value=window.clipboardData.getData('text')">
<input type="button" value="复制" onclick="window.clipboardData.setData('text',document.getElementsByName('output0')[0].value);">
<input type="button" value="清空" onclick="document.getElementsByName('output0')[0].value=''">
<br>
<br>
<input type="button" value="加密" onclick="document.getElementsByName('output0')[0].value=Base64.encode(document.getElementsByName('input0')[0].value)">
<input type="button" value="解密" onclick="document.getElementsByName('output0')[0].value=Base64.decode(document.getElementsByName('input0')[0].value)">
<input type="button" value="下载为文本" onclick="DownloadStr('save.txt',document.getElementsByName('output0')[0].value)">
<br>
<span style="color:#888888;"><font size="1">Made by func16</font></span>

<script type="text/javascript">
	//Upload monitor
	document.getElementById("upfile").addEventListener("change",function () {
		var file = document.getElementById('upfile').files[0];
		var reader = new FileReader();
		reader.readAsText(file,'utf-8');
 		reader.onload = function () {
			document.getElementsByName('output0')[0].value = Base64.encode(reader.result)
		}
	});
	//DownloadStr Function,fixed&opti by func16//
	function DownloadStr(name, data) {
		var urlObject = window.URL || window.webkitURL || window;
		var export_blob = new Blob([data]);
		var save_link = document.createElement("a")
		save_link.href = urlObject.createObjectURL(export_blob);
		save_link.download = name;
		var clickEvent = document.createEvent("MouseEvents");
		clickEvent.initEvent("click", true, true);  
		save_link.dispatchEvent(clickEvent);
	}
	//Base64 Source//
	function Base64() {
	// private property 
	_keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="; 
	 
	// public method for encoding 
	this.encode = function (input) { 
	  var output = ""; 
	  var chr1, chr2, chr3, enc1, enc2, enc3, enc4; 
	  var i = 0; 
	  input = _utf8_encode(input); 
	  while (i < input.length) { 
		chr1 = input.charCodeAt(i++); 
		chr2 = input.charCodeAt(i++); 
		chr3 = input.charCodeAt(i++); 
		enc1 = chr1 >> 2; 
		enc2 = ((chr1 & 3) << 4) | (chr2 >> 4); 
		enc3 = ((chr2 & 15) << 2) | (chr3 >> 6); 
		enc4 = chr3 & 63; 
		if (isNaN(chr2)) { 
		  enc3 = enc4 = 64; 
		} else if (isNaN(chr3)) { 
		  enc4 = 64; 
		} 
		output = output + 
		_keyStr.charAt(enc1) + _keyStr.charAt(enc2) + 
		_keyStr.charAt(enc3) + _keyStr.charAt(enc4); 
	  } 
	  return output; 
	} 
	 
	// public method for decoding 
	this.decode = function (input) { 
	  var output = ""; 
	  var chr1, chr2, chr3; 
	  var enc1, enc2, enc3, enc4; 
	  var i = 0; 
	  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, ""); 
	  while (i < input.length) { 
		enc1 = _keyStr.indexOf(input.charAt(i++)); 
		enc2 = _keyStr.indexOf(input.charAt(i++)); 
		enc3 = _keyStr.indexOf(input.charAt(i++)); 
		enc4 = _keyStr.indexOf(input.charAt(i++)); 
		chr1 = (enc1 << 2) | (enc2 >> 4); 
		chr2 = ((enc2 & 15) << 4) | (enc3 >> 2); 
		chr3 = ((enc3 & 3) << 6) | enc4; 
		output = output + String.fromCharCode(chr1); 
		if (enc3 != 64) { 
		  output = output + String.fromCharCode(chr2); 
		} 
		if (enc4 != 64) { 
		  output = output + String.fromCharCode(chr3); 
		} 
	  } 
	  output = _utf8_decode(output); 
	  return output; 
	} 
	 
	// private method for UTF-8 encoding 
	_utf8_encode = function (string) { 
	  string = string.replace(/\r\n/g,"\n"); 
	  var utftext = ""; 
	  for (var n = 0; n < string.length; n++) { 
		var c = string.charCodeAt(n); 
		if (c < 128) { 
		  utftext += String.fromCharCode(c); 
		} else if((c > 127) && (c < 2048)) { 
		  utftext += String.fromCharCode((c >> 6) | 192); 
		  utftext += String.fromCharCode((c & 63) | 128); 
		} else { 
		  utftext += String.fromCharCode((c >> 12) | 224); 
		  utftext += String.fromCharCode(((c >> 6) & 63) | 128); 
		  utftext += String.fromCharCode((c & 63) | 128); 
		} 
	 
	  } 
	  return utftext; 
	} 
	 
	// private method for UTF-8 decoding 
	_utf8_decode = function (utftext) { 
	  var string = ""; 
	  var i = 0; 
	  var c = c1 = c2 = 0; 
	  while ( i < utftext.length ) { 
		c = utftext.charCodeAt(i); 
		if (c < 128) { 
		  string += String.fromCharCode(c); 
		  i++; 
		} else if((c > 191) && (c < 224)) { 
		  c2 = utftext.charCodeAt(i+1); 
		  string += String.fromCharCode(((c & 31) << 6) | (c2 & 63)); 
		  i += 2; 
		} else { 
		  c2 = utftext.charCodeAt(i+1); 
		  c3 = utftext.charCodeAt(i+2); 
		  string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)); 
		  i += 3; 
		} 
	  } 
	  return string; 
	} 
	}
	Base64=new Base64;
</script>

</body>
</html>
